<Window x:Class="USB_Guard.Dialogs.MouseAuthenticationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mouse Authentication - USB Guard" 
        Height="700" Width="800"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        FontFamily="Segoe UI"
        Background="#F0F0F0">

    <Window.Resources>
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#FF9800" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="🖱️ USB Mouse Authentication" 
                               FontSize="18" FontWeight="Bold" 
                               Foreground="White" HorizontalAlignment="Center"/>
                    <TextBlock Text="STEP 4: Perform left/right clicks and scroll to authenticate mouse" 
                               FontSize="12" Foreground="White" 
                               HorizontalAlignment="Center" Margin="0,5,0,0" Opacity="0.9"/>
                </StackPanel>
            </Border>

            <!-- Device Information -->
            <Border Grid.Row="1" Background="White" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Device Name:" FontWeight="SemiBold" Margin="0,0,10,5"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="DeviceNameText" Text="[Device Name]" Margin="0,0,0,5"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Type:" FontWeight="SemiBold" Margin="0,0,10,5"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="DeviceTypeText" Text="🖱️ Mouse" Margin="0,0,0,5"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Vendor ID:" FontWeight="SemiBold" Margin="0,0,10,5"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="VendorIdText" Text="[VID]" Margin="0,0,0,5"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Product ID:" FontWeight="SemiBold" Margin="0,0,10,5"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="ProductIdText" Text="[PID]" Margin="0,0,0,5"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Buttons:" FontWeight="SemiBold" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="4" Grid.Column="1" x:Name="MouseButtonsText" Text="[Button Count]"/>
                </Grid>
            </Border>

            <!-- Authentication Progress -->
            <Border Grid.Row="2" Background="#FFF3E0" CornerRadius="8" Padding="20" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="🔐 STEP 4: Mouse Verification Challenge" 
                               FontSize="16" FontWeight="Bold" 
                               HorizontalAlignment="Center" Margin="0,0,0,15"
                               Foreground="#E65100"/>

                    <TextBlock x:Name="ProgressText" Text="Progress: 0/4 tests completed" 
                               FontSize="14" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    
                    <ProgressBar x:Name="ProgressBar" Height="12" Minimum="0" Maximum="100" Value="0" 
                                 Background="#E0E0E0" Foreground="#FF9800"/>
                    
                    <TextBlock x:Name="StatusText" Text="Use the new mouse to perform all required actions in the test area below" 
                               FontSize="12" HorizontalAlignment="Center" Margin="0,10,0,0" Foreground="#666"/>
                </StackPanel>
            </Border>

            <!-- Mouse Test Area -->
            <Border Grid.Row="3" Background="White" CornerRadius="8" Padding="20" Margin="0,0,0,15"
                    BorderBrush="#FF9800" BorderThickness="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="🖱️ STEP 4: Interactive Mouse Test Area" FontSize="16" FontWeight="SemiBold" 
                               HorizontalAlignment="Center" Margin="0,0,0,15" Foreground="#E65100"/>

                    <!-- Interactive test area with scroll viewer -->
                    <ScrollViewer Grid.Row="1" x:Name="TestScrollViewer" Height="200" 
                                  VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
                                  PreviewMouseWheel="TestScrollViewer_PreviewMouseWheel">
                        <Border Background="#F8F8F8" CornerRadius="5" Padding="20" MinHeight="400" MinWidth="600"
                                x:Name="TestArea" Cursor="Cross"
                                MouseMove="TestArea_MouseMove"
                                MouseLeftButtonDown="TestArea_MouseLeftButtonDown"
                                MouseRightButtonDown="TestArea_MouseRightButtonDown"
                                MouseLeftButtonUp="TestArea_MouseLeftButtonUp"
                                MouseRightButtonUp="TestArea_MouseRightButtonUp">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="🖱️" FontSize="64" HorizontalAlignment="Center" Opacity="0.5"/>
                                <TextBlock Text="STEP 4: Use the NEW mouse here" FontSize="16" FontWeight="Bold"
                                           HorizontalAlignment="Center" Margin="0,15,0,5" Foreground="#E65100"/>
                                <TextBlock Text="✓ Left Click ✓ Right Click ✓ Scroll Wheel ✓ Mouse Movement" FontSize="14" 
                                           HorizontalAlignment="Center" Margin="0,5,0,10" Foreground="#666"/>
                                <TextBlock Text="This area is larger than the window - try scrolling!" FontSize="12" 
                                           HorizontalAlignment="Center" Foreground="#999"/>
                                <Rectangle Width="400" Height="100" Fill="LightBlue" Margin="0,20,0,0" Opacity="0.3"/>
                                <TextBlock Text="Scroll to see more content..." FontSize="12" 
                                           HorizontalAlignment="Center" Margin="0,10,0,0" Foreground="#999"/>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>

                    <!-- Test Status Grid -->
                    <Border Grid.Row="2" Background="#F5F5F5" CornerRadius="5" Padding="15" Margin="0,15,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                <TextBlock x:Name="LeftClickStatus" Text="⭕ Left Click" 
                                           FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock x:Name="LeftClickCountText" Text="Clicks: 0/3" FontSize="10" 
                                           HorizontalAlignment="Center" Foreground="#666"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                <TextBlock x:Name="RightClickStatus" Text="⭕ Right Click" 
                                           FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock x:Name="RightClickCountText" Text="Clicks: 0/3" FontSize="10" 
                                           HorizontalAlignment="Center" Foreground="#666"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                <TextBlock x:Name="ScrollStatus" Text="⭕ Scroll Wheel" 
                                           FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock x:Name="ScrollCountText" Text="Scrolls: 0/5" FontSize="10" 
                                           HorizontalAlignment="Center" Foreground="#666"/>
                            </StackPanel>

                            <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                <TextBlock x:Name="MoveStatus" Text="⭕ Movement" 
                                           FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock x:Name="MoveCountText" Text="Moves: 0/10" FontSize="10" 
                                           HorizontalAlignment="Center" Foreground="#666"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Error Display -->
            <Border Grid.Row="4" x:Name="ErrorPanel" Background="#FFEBEE" CornerRadius="8" 
                    Padding="15" Margin="0,0,0,15" Visibility="Collapsed">
                <TextBlock x:Name="ErrorText" Text="[Error Message]" 
                           Foreground="#D32F2F" FontWeight="SemiBold" TextWrapping="Wrap"/>
            </Border>

            <!-- Failed Attempts Warning -->
            <Border Grid.Row="5" x:Name="WarningPanel" Background="#FFF3E0" CornerRadius="8" 
                    Padding="15" Margin="0,0,0,15" Visibility="Collapsed">
                <StackPanel>
                    <TextBlock Text="⚠️ Authentication Warning:" FontSize="14" FontWeight="SemiBold" 
                               Foreground="#F57C00" Margin="0,0,0,5"/>
                    <TextBlock x:Name="WarningText" Text="[Warning Message]" 
                               Foreground="#E65100" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Instructions -->
            <Border Grid.Row="6" Background="White" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock Text="📋 STEP 4: Instructions:" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,10"/>
                    <TextBlock Text="• Use the newly connected mouse to perform all required actions
• Complete all 4 tests: Left clicks (3), Right clicks (3), Scroll wheel (5), Mouse movement (10)
• You have 3 minutes to complete authentication
• After 2 failed attempts, the mouse will be permanently blocked" 
                               FontSize="11" Foreground="#666" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Timer -->
            <Border Grid.Row="7" Background="#FFEBEE" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                <StackPanel>
                    <TextBlock x:Name="TimerText" Text="STEP 4: Time remaining: 180 seconds" 
                               FontSize="16" FontWeight="SemiBold" 
                               HorizontalAlignment="Center" Foreground="#D32F2F"/>
                    
                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15,0,0">
                        <Button x:Name="AllowButton" Content="✓ Authenticate Mouse" 
                                Background="#CCCCCC" Foreground="White"
                                Style="{StaticResource ModernButton}" 
                                Click="AllowButton_Click" Margin="0,0,10,0"
                                IsEnabled="False"/>
                        <Button x:Name="ResetButton" Content="🔄 Reset Test" 
                                Background="#2196F3" Foreground="White"
                                Style="{StaticResource ModernButton}" 
                                Click="ResetButton_Click" Margin="0,0,10,0"/>
                        <Button x:Name="BlockButton" Content="✗ Block Mouse" 
                                Background="#F44336" Foreground="White"
                                Style="{StaticResource ModernButton}" 
                                Click="BlockButton_Click"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</Window>
